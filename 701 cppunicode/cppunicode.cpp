// cppunicode: test of unicode in C++
// utf8 conversions rom http://utfcpp.sourceforge.net/
// Implements a simple conversion to lowercase without accents
// LowerNoAccentMap is generated using C# program GenerateCppUnicodeData
// 2019-11-07   PV

#include <iostream>
#include <vector>
#include <assert.h>
#include <map>

#include "utf8.h"

using namespace std;
using namespace utf8;

map<int, int> LowerNoAccentMap = {
    {0x41, 0x61},   // A
    {0x42, 0x62},   // B
    {0x43, 0x63},   // C
    {0x44, 0x64},   // D
    {0x45, 0x65},   // E
    {0x46, 0x66},   // F
    {0x47, 0x67},   // G
    {0x48, 0x68},   // H
    {0x49, 0x69},   // I
    {0x4a, 0x6a},   // J
    {0x4b, 0x6b},   // K
    {0x4c, 0x6c},   // L
    {0x4d, 0x6d},   // M
    {0x4e, 0x6e},   // N
    {0x4f, 0x6f},   // O
    {0x50, 0x70},   // P
    {0x51, 0x71},   // Q
    {0x52, 0x72},   // R
    {0x53, 0x73},   // S
    {0x54, 0x74},   // T
    {0x55, 0x75},   // U
    {0x56, 0x76},   // V
    {0x57, 0x77},   // W
    {0x58, 0x78},   // X
    {0x59, 0x79},   // Y
    {0x5a, 0x7a},   // Z
    {0xc0, 0x61},   // À
    {0xc1, 0x61},   // Á
    {0xc2, 0x61},   // Â
    {0xc3, 0x61},   // Ã
    {0xc4, 0x61},   // Ä
    {0xc5, 0x61},   // Å
    {0xc6, 0xe6},   // Æ
    {0xc7, 0x63},   // Ç
    {0xc8, 0x65},   // È
    {0xc9, 0x65},   // É
    {0xca, 0x65},   // Ê
    {0xcb, 0x65},   // Ë
    {0xcc, 0x69},   // Ì
    {0xcd, 0x69},   // Í
    {0xce, 0x69},   // Î
    {0xcf, 0x69},   // Ï
    {0xd0, 0xf0},   // Ð
    {0xd1, 0x6e},   // Ñ
    {0xd2, 0x6f},   // Ò
    {0xd3, 0x6f},   // Ó
    {0xd4, 0x6f},   // Ô
    {0xd5, 0x6f},   // Õ
    {0xd6, 0x6f},   // Ö
    {0xd8, 0xf8},   // Ø
    {0xd9, 0x75},   // Ù
    {0xda, 0x75},   // Ú
    {0xdb, 0x75},   // Û
    {0xdc, 0x75},   // Ü
    {0xdd, 0x79},   // Ý
    {0xde, 0xfe},   // Þ
    {0xe0, 0x61},   // à
    {0xe1, 0x61},   // á
    {0xe2, 0x61},   // â
    {0xe3, 0x61},   // ã
    {0xe4, 0x61},   // ä
    {0xe5, 0x61},   // å
    {0xe7, 0x63},   // ç
    {0xe8, 0x65},   // è
    {0xe9, 0x65},   // é
    {0xea, 0x65},   // ê
    {0xeb, 0x65},   // ë
    {0xec, 0x69},   // ì
    {0xed, 0x69},   // í
    {0xee, 0x69},   // î
    {0xef, 0x69},   // ï
    {0xf1, 0x6e},   // ñ
    {0xf2, 0x6f},   // ò
    {0xf3, 0x6f},   // ó
    {0xf4, 0x6f},   // ô
    {0xf5, 0x6f},   // õ
    {0xf6, 0x6f},   // ö
    {0xf9, 0x75},   // ù
    {0xfa, 0x75},   // ú
    {0xfb, 0x75},   // û
    {0xfc, 0x75},   // ü
    {0xfd, 0x79},   // ý
    {0xff, 0x79},   // ÿ
    {0x100, 0x61},  // Ā
    {0x101, 0x61},  // ā
    {0x102, 0x61},  // Ă
    {0x103, 0x61},  // ă
    {0x104, 0x61},  // Ą
    {0x105, 0x61},  // ą
    {0x106, 0x63},  // Ć
    {0x107, 0x63},  // ć
    {0x108, 0x63},  // Ĉ
    {0x109, 0x63},  // ĉ
    {0x10a, 0x63},  // Ċ
    {0x10b, 0x63},  // ċ
    {0x10c, 0x63},  // Č
    {0x10d, 0x63},  // č
    {0x10e, 0x64},  // Ď
    {0x10f, 0x64},  // ď
    {0x110, 0x111}, // Đ
    {0x112, 0x65},  // Ē
    {0x113, 0x65},  // ē
    {0x114, 0x65},  // Ĕ
    {0x115, 0x65},  // ĕ
    {0x116, 0x65},  // Ė
    {0x117, 0x65},  // ė
    {0x118, 0x65},  // Ę
    {0x119, 0x65},  // ę
    {0x11a, 0x65},  // Ě
    {0x11b, 0x65},  // ě
    {0x11c, 0x67},  // Ĝ
    {0x11d, 0x67},  // ĝ
    {0x11e, 0x67},  // Ğ
    {0x11f, 0x67},  // ğ
    {0x120, 0x67},  // Ġ
    {0x121, 0x67},  // ġ
    {0x122, 0x67},  // Ģ
    {0x123, 0x67},  // ģ
    {0x124, 0x68},  // Ĥ
    {0x125, 0x68},  // ĥ
    {0x126, 0x127}, // Ħ
    {0x128, 0x69},  // Ĩ
    {0x129, 0x69},  // ĩ
    {0x12a, 0x69},  // Ī
    {0x12b, 0x69},  // ī
    {0x12c, 0x69},  // Ĭ
    {0x12d, 0x69},  // ĭ
    {0x12e, 0x69},  // Į
    {0x12f, 0x69},  // į
    {0x130, 0x69},  // İ
    {0x132, 0x133}, // Ĳ
    {0x134, 0x6a},  // Ĵ
    {0x135, 0x6a},  // ĵ
    {0x136, 0x6b},  // Ķ
    {0x137, 0x6b},  // ķ
    {0x139, 0x6c},  // Ĺ
    {0x13a, 0x6c},  // ĺ
    {0x13b, 0x6c},  // Ļ
    {0x13c, 0x6c},  // ļ
    {0x13d, 0x6c},  // Ľ
    {0x13e, 0x6c},  // ľ
    {0x13f, 0x140}, // Ŀ
    {0x141, 0x142}, // Ł
    {0x143, 0x6e},  // Ń
    {0x144, 0x6e},  // ń
    {0x145, 0x6e},  // Ņ
    {0x146, 0x6e},  // ņ
    {0x147, 0x6e},  // Ň
    {0x148, 0x6e},  // ň
    {0x14a, 0x14b}, // Ŋ
    {0x14c, 0x6f},  // Ō
    {0x14d, 0x6f},  // ō
    {0x14e, 0x6f},  // Ŏ
    {0x14f, 0x6f},  // ŏ
    {0x150, 0x6f},  // Ő
    {0x151, 0x6f},  // ő
    {0x152, 0x153}, // Œ
    {0x154, 0x72},  // Ŕ
    {0x155, 0x72},  // ŕ
    {0x156, 0x72},  // Ŗ
    {0x157, 0x72},  // ŗ
    {0x158, 0x72},  // Ř
    {0x159, 0x72},  // ř
    {0x15a, 0x73},  // Ś
    {0x15b, 0x73},  // ś
    {0x15c, 0x73},  // Ŝ
    {0x15d, 0x73},  // ŝ
    {0x15e, 0x73},  // Ş
    {0x15f, 0x73},  // ş
    {0x160, 0x73},  // Š
    {0x161, 0x73},  // š
    {0x162, 0x74},  // Ţ
    {0x163, 0x74},  // ţ
    {0x164, 0x74},  // Ť
    {0x165, 0x74},  // ť
    {0x166, 0x167}, // Ŧ
    {0x168, 0x75},  // Ũ
    {0x169, 0x75},  // ũ
    {0x16a, 0x75},  // Ū
    {0x16b, 0x75},  // ū
    {0x16c, 0x75},  // Ŭ
    {0x16d, 0x75},  // ŭ
    {0x16e, 0x75},  // Ů
    {0x16f, 0x75},  // ů
    {0x170, 0x75},  // Ű
    {0x171, 0x75},  // ű
    {0x172, 0x75},  // Ų
    {0x173, 0x75},  // ų
    {0x174, 0x77},  // Ŵ
    {0x175, 0x77},  // ŵ
    {0x176, 0x79},  // Ŷ
    {0x177, 0x79},  // ŷ
    {0x178, 0x79},  // Ÿ
    {0x179, 0x7a},  // Ź
    {0x17a, 0x7a},  // ź
    {0x17b, 0x7a},  // Ż
    {0x17c, 0x7a},  // ż
    {0x17d, 0x7a},  // Ž
    {0x17e, 0x7a},  // ž
    {0x182, 0x183}, // Ƃ
    {0x184, 0x185}, // Ƅ
    {0x187, 0x188}, // Ƈ
    {0x18b, 0x18c}, // Ƌ
    {0x18e, 0x1dd}, // Ǝ
    {0x191, 0x192}, // Ƒ
    {0x198, 0x199}, // Ƙ
    {0x1a0, 0x6f},  // Ơ
    {0x1a1, 0x6f},  // ơ
    {0x1a2, 0x1a3}, // Ƣ
    {0x1a4, 0x1a5}, // Ƥ
    {0x1a7, 0x1a8}, // Ƨ
    {0x1ac, 0x1ad}, // Ƭ
    {0x1af, 0x75},  // Ư
    {0x1b0, 0x75},  // ư
    {0x1b3, 0x1b4}, // Ƴ
    {0x1b5, 0x1b6}, // Ƶ
    {0x1b8, 0x1b9}, // Ƹ
    {0x1bc, 0x1bd}, // Ƽ
    {0x1c4, 0x1c6}, // Ǆ
    {0x1c7, 0x1c9}, // Ǉ
    {0x1ca, 0x1cc}, // Ǌ
    {0x1cd, 0x61},  // Ǎ
    {0x1ce, 0x61},  // ǎ
    {0x1cf, 0x69},  // Ǐ
    {0x1d0, 0x69},  // ǐ
    {0x1d1, 0x6f},  // Ǒ
    {0x1d2, 0x6f},  // ǒ
    {0x1d3, 0x75},  // Ǔ
    {0x1d4, 0x75},  // ǔ
    {0x1d5, 0x75},  // Ǖ
    {0x1d6, 0x75},  // ǖ
    {0x1d7, 0x75},  // Ǘ
    {0x1d8, 0x75},  // ǘ
    {0x1d9, 0x75},  // Ǚ
    {0x1da, 0x75},  // ǚ
    {0x1db, 0x75},  // Ǜ
    {0x1dc, 0x75},  // ǜ
    {0x1de, 0x61},  // Ǟ
    {0x1df, 0x61},  // ǟ
    {0x1e0, 0x61},  // Ǡ
    {0x1e1, 0x61},  // ǡ
    {0x1e2, 0xe6},  // Ǣ
    {0x1e3, 0xe6},  // ǣ
    {0x1e4, 0x1e5}, // Ǥ
    {0x1e6, 0x67},  // Ǧ
    {0x1e7, 0x67},  // ǧ
    {0x1e8, 0x6b},  // Ǩ
    {0x1e9, 0x6b},  // ǩ
    {0x1ea, 0x6f},  // Ǫ
    {0x1eb, 0x6f},  // ǫ
    {0x1ec, 0x6f},  // Ǭ
    {0x1ed, 0x6f},  // ǭ
    {0x1f0, 0x6a},  // ǰ
    {0x1f1, 0x1f3}, // Ǳ
    {0x1f4, 0x67},  // Ǵ
    {0x1f5, 0x67},  // ǵ
    {0x1f6, 0x195}, // Ƕ
    {0x1f7, 0x1bf}, // Ƿ
    {0x1f8, 0x6e},  // Ǹ
    {0x1f9, 0x6e},  // ǹ
    {0x1fa, 0x61},  // Ǻ
    {0x1fb, 0x61},  // ǻ
    {0x1fc, 0xe6},  // Ǽ
    {0x1fd, 0xe6},  // ǽ
    {0x1fe, 0xf8},  // Ǿ
    {0x1ff, 0xf8},  // ǿ
    {0x200, 0x61},  // Ȁ
    {0x201, 0x61},  // ȁ
    {0x202, 0x61},  // Ȃ
    {0x203, 0x61},  // ȃ
    {0x204, 0x65},  // Ȅ
    {0x205, 0x65},  // ȅ
    {0x206, 0x65},  // Ȇ
    {0x207, 0x65},  // ȇ
    {0x208, 0x69},  // Ȉ
    {0x209, 0x69},  // ȉ
    {0x20a, 0x69},  // Ȋ
    {0x20b, 0x69},  // ȋ
    {0x20c, 0x6f},  // Ȍ
    {0x20d, 0x6f},  // ȍ
    {0x20e, 0x6f},  // Ȏ
    {0x20f, 0x6f},  // ȏ
    {0x210, 0x72},  // Ȑ
    {0x211, 0x72},  // ȑ
    {0x212, 0x72},  // Ȓ
    {0x213, 0x72},  // ȓ
    {0x214, 0x75},  // Ȕ
    {0x215, 0x75},  // ȕ
    {0x216, 0x75},  // Ȗ
    {0x217, 0x75},  // ȗ
    {0x218, 0x73},  // Ș
    {0x219, 0x73},  // ș
    {0x21a, 0x74},  // Ț
    {0x21b, 0x74},  // ț
    {0x21c, 0x21d}, // Ȝ
    {0x21e, 0x68},  // Ȟ
    {0x21f, 0x68},  // ȟ
    {0x220, 0x19e}, // Ƞ
    {0x222, 0x223}, // Ȣ
    {0x224, 0x225}, // Ȥ
    {0x226, 0x61},  // Ȧ
    {0x227, 0x61},  // ȧ
    {0x228, 0x65},  // Ȩ
    {0x229, 0x65},  // ȩ
    {0x22a, 0x6f},  // Ȫ
    {0x22b, 0x6f},  // ȫ
    {0x22c, 0x6f},  // Ȭ
    {0x22d, 0x6f},  // ȭ
    {0x22e, 0x6f},  // Ȯ
    {0x22f, 0x6f},  // ȯ
    {0x230, 0x6f},  // Ȱ
    {0x231, 0x6f},  // ȱ
    {0x232, 0x79},  // Ȳ
    {0x233, 0x79},  // ȳ
    {0x23b, 0x23c}, // Ȼ
    {0x23d, 0x19a}, // Ƚ
    {0x241, 0x242}, // Ɂ
    {0x243, 0x180}, // Ƀ
    {0x246, 0x247}, // Ɇ
    {0x248, 0x249}, // Ɉ
    {0x24a, 0x24b}, // Ɋ
    {0x24c, 0x24d}, // Ɍ
    {0x24e, 0x24f}, // Ɏ
};

string ToLowerNoAccent(string s)
{
    vector<int> utf32result;
    unchecked::utf8to32(begin(s), end(s), back_inserter(utf32result));
    for (auto &c : utf32result)
    {
        auto it = LowerNoAccentMap.find(c);
        if (it != end(LowerNoAccentMap))
            c = it->second;
    }
    vector<unsigned char> utf8result;
    utf32to8(begin(utf32result), end(utf32result), back_inserter(utf8result));
    string res(begin(utf8result), end(utf8result));
    return res;
}

int main()
{
    string s = "Aÿ ây àŸ!  Où ça? Là!";
    string t = ToLowerNoAccent(s);
    cout << t;
}
